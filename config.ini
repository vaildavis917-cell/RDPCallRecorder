; ============================================================
; RDP Call Recorder Agent — Конфигурация
; Версия: 2.6
; ============================================================
; Этот файл должен лежать рядом с RDPCallRecorder.exe
; Все параметры имеют значения по умолчанию.

[Recording]
; Путь для сохранения записей.
; Структура: {RecordingPath}\{ПолноеИмя}\{YYYY-MM-DD}\{Дата}_{ПолноеИмя}_{Приложение}_{Время}.mp3
; ПолноеИмя берётся из профиля Windows (например: Nicole, Vladislav AFF)
; Путь по умолчанию: %USERPROFILE%\CallRecordings
; Оставьте пустым для автоопределения, или укажите свой путь
RecordingPath=

; Формат записи: mp3, wav
AudioFormat=mp3

; Битрейт MP3 (рекомендуется 128000 для голоса)
MP3Bitrate=128000

[Monitoring]
; Интервал проверки активности звонков (секунды). Рекомендуется 2.
PollInterval=2

; Порог тишины: сколько циклов подряд нет аудио, прежде чем остановить запись.
; При PollInterval=2 и SilenceThreshold=15 — запись остановится через ~30 сек тишины.
; Раньше было 3 (6 сек) — слишком мало, паузы в разговоре разрезали запись на обрывки.
SilenceThreshold=15

; Минимальная длительность записи (секунды).
; Первые N секунд после старта записи — тишина НЕ останавливает запись.
; Это предотвращает обрывки в начале звонка (гудки, ожидание ответа).
; По умолчанию 60 секунд.
MinRecordingSeconds=60

; Порог старта: сколько циклов подряд РЕАЛЬНЫЙ звук должен быть активен,
; прежде чем начать запись. Защищает от ложных срабатываний на уведомления.
; При PollInterval=2 и StartThreshold=2 — запись начнётся через ~4 сек непрерывного звука.
; Увеличьте до 3-4 если уведомления всё ещё вызывают запись.
StartThreshold=2

; === Telegram-специфичные настройки ===
;
; Telegram Desktop детектируется по ОКНУ ЗВОНКА:
; Во время звонка Telegram создаёт отдельное окно с именем контакта.
; Главное окно Telegram имеет заголовок "Telegram" или "Telegram (N)".
; Если есть окно с другим заголовком — значит идёт звонок.
;
; Это полностью отсекает:
;   - Уведомления (звук без окна звонка)
;   - Голосовые сообщения (прослушивание без окна звонка)
;   - Видео/музыку в чатах
;
; Для СТАРТА записи: нужен аудио-пик + окно звонка Telegram.
; Для ОСТАНОВКИ записи: окно звонка исчезло.

; --- Детекция остановки ---
; Сколько циклов подряд окно звонка должно отсутствовать,
; чтобы остановить запись. Небольшой буфер на случай мигания окна.
; При PollInterval=2 и TelegramSilenceCycles=3 — запись остановится через ~6 сек.
TelegramSilenceCycles=3

; --- Вспомогательные параметры (для логирования) ---
; Размер окна скользящего среднего пика (в циклах опроса).
TelegramPeakHistorySize=5

; Порог среднего пика (используется только в логах для диагностики).
TelegramSilencePeakThreshold=0.03

[Processes]
; Список процессов для мониторинга (через запятую)
TargetProcesses=WhatsApp.exe,WhatsApp.Root.exe,Telegram.exe,Viber.exe

[Logging]
EnableLogging=true
LogLevel=DEBUG
MaxLogSizeMB=10

[Advanced]
; Скрывать окно (true для production)
HideConsole=true

; Мьютекс — один экземпляр на RDP-сессию
UseMutex=true
MutexName=Local\RDPCallRecorderAgentMutex

; Приоритет процесса (BelowNormal — минимальная нагрузка)
ProcessPriority=BelowNormal

; Автоматически прописывать себя в автозапуск при первом запуске
AutoRegisterStartup=true

; Автообновление через GitHub Releases
; Агент проверяет наличие новой версии при старте и каждые N часов
AutoUpdate=true
UpdateCheckIntervalHours=6

Configured=true
